p8105\_hw3\_fwt2107
================
Felix Tran
October 4, 2018

Problem 1
=========

Data cleaning
-------------

This block of code loads and cleans the BRFSS data:

1.  Load the BRFSS data from the p8105.datasets package

2.  Clean the variable names

3.  Only keep the observations related to the Overall Health topic

4.  Remove unneeded variables

5.  Transform **response** into a factor with the values ordered from "Excellent" to "Poor"

6.  Separate **locationdesc** into 2 variables (**state** and **location**) for the state and site for each observation

7.  Remove the redundant **locationabbr** variable

``` r
library(p8105.datasets)
brfss_df <- brfss_smart2010 %>% 
  janitor::clean_names() %>%
  filter(topic == "Overall Health") %>%
  select(-class, -topic,  -question, -c(confidence_limit_low:geo_location)) %>%
  mutate(response = forcats::fct_relevel(response, "Excellent", "Very good",
                                         "Good", "Fair", "Poor")) %>% 
  separate(locationdesc, into = c('state', 'location'), sep = ' - ') %>%
  select(-locationabbr)

brfss_df
```

    ## # A tibble: 10,625 x 6
    ##     year state location         response  sample_size data_value
    ##    <int> <chr> <chr>            <fct>           <int>      <dbl>
    ##  1  2010 AL    Jefferson County Excellent          94       18.9
    ##  2  2010 AL    Jefferson County Very good         148       30  
    ##  3  2010 AL    Jefferson County Good              208       33.1
    ##  4  2010 AL    Jefferson County Fair              107       12.5
    ##  5  2010 AL    Jefferson County Poor               45        5.5
    ##  6  2010 AL    Mobile County    Excellent          91       15.6
    ##  7  2010 AL    Mobile County    Very good         177       31.3
    ##  8  2010 AL    Mobile County    Good              224       31.2
    ##  9  2010 AL    Mobile County    Fair              120       15.5
    ## 10  2010 AL    Mobile County    Poor               66        6.4
    ## # ... with 10,615 more rows

Answering questions about the data
----------------------------------

### States observed at 7 locations in 2002

3 states were observed at 7 locations in 2002: Connecticut, Florida, and North Carolina.

Using the brfss\_df dataset:

1.  Filter observations to only look at observations from 2002

2.  Group by **state**

3.  Count the number of unique **location** values and only see the states with 7 location sites

``` r
brfss_df %>% 
  filter(year == '2002') %>% 
  group_by(state) %>%
  summarize(num_sites = length(unique(location))) %>% 
  filter(num_sites == 7)
```

    ## # A tibble: 3 x 2
    ##   state num_sites
    ##   <chr>     <int>
    ## 1 CT            7
    ## 2 FL            7
    ## 3 NC            7

### Spaghetti plot

1.  Group the brfss data by year and state

2.  Sum up the number of observations for each state by year

3.  Plot the number of observations for each state by year

4.  Add labels and adjust the plot theme and legend font size

``` r
brfss_df %>% 
  group_by(year, state) %>% 
  summarize(total_obs = sum(sample_size)) %>% 
  ggplot(aes(x = year, y = total_obs, color = state)) + 
  geom_line(alpha = 0.5) + 
  labs(title = "Number of observations in each state by year", 
       x = "Year (2002 - 2010)",
       y = "Number of observations") +
  theme(legend.text = element_text(size = 5),
        plot.title = element_text(size = 13))
```

<img src="p8105_hw3_fwt2107_files/figure-markdown_github/unnamed-chunk-3-1.png" width="90%" />

### Table describing "Excellent" responses in NY (2002, 2006, 2010)

1.  Subset the brfss data to only look at "excellent" responses for NY

2.  Group observations by year

3.  Calculate the mean and standard deviation for proportion of "excellent" responses in NY by year

4.  Keep the means and standard deviations for the years 2002, 2006, 2010

5.  Display results in table

``` r
brfss_df %>% 
  filter(state == "NY", response == "Excellent") %>% 
  group_by(year) %>% 
  summarize(mean_excellent = mean(data_value, na.rm = T), 
            sd_excellent = sd(data_value, na.rm = T)) %>% 
  filter(year == "2002" | year == "2006" | year == "2010") %>% 
  knitr::kable(col.names = c("Year", "Mean", "Standard deviation"), 
               digits = 1,
               format = 'html',
               caption = "Proportion of 'excellent' responses in NY by year")
```

<table>
<caption>
Proportion of 'excellent' responses in NY by year
</caption>
<thead>
<tr>
<th style="text-align:right;">
Year
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Standard deviation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2002
</td>
<td style="text-align:right;">
24.0
</td>
<td style="text-align:right;">
4.5
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
22.5
</td>
<td style="text-align:right;">
4.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2010
</td>
<td style="text-align:right;">
22.7
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
</tbody>
</table>
